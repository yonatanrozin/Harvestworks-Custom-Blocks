{"version":3,"file":"event-list/view.js","mappings":"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","sources":["webpack://harvestworks/./src/event-list/view.js"],"sourcesContent":["/**\n * Use this file for JavaScript code that you want to run in the front-end\n * on posts/pages that contain this block.\n *\n * When this file is defined as the value of the `viewScript` property\n * in `block.json` it will be enqueued on the front end of the site.\n *\n * Example:\n *\n * ```js\n * {\n *   \"viewScript\": \"file:./view.js\"\n * }\n * ```\n *\n * If you're not making any changes to this file because your project doesn't need any\n * JavaScript running in the front-end, then you should delete this file and remove\n * the `viewScript` property from `block.json`.\n *\n * @see https://developer.wordpress.org/block-editor/reference-guides/block-api/block-metadata/#view-script\n */\n\n/* eslint-disable no-console */\n\nconst block_div = document.querySelector(\".wp-block-harvestworks-event-list\");\n\nfunction dateFromACFField(date) {\n    if (!date) return null;\n    const year = date.substring(0, 4);\n    const month = date.substring(4, 6) - 1; //JS months counting from 0\n    const day = date.substring(6, 8);\n    return new Date(year, month, day).toLocaleString('default', { \"month\": \"short\", \"day\": \"2-digit\" });\n}\n\nfunction eventCard(event) {\n\n    try {\n\n\n        const { post_title, acf, featured_image, guid, status, excerpt } = event;\n        const { date, time, end_date, end_time, location, event_type, artists } = acf;\n\n        return `\n            <div class=\"event_card\">\n                <a class=\"event_anchor\" href=\"${guid}\"></a>\n                <div class=\"event_img\" style=\"background-image: url(${featured_image})\" >\n                    ${status ? `<span class=\"event_status\">${status}</span>` : \"\"}\n                </div>\n                <div class=\"event_info\">\n                    <div class=\"event_details\" >\n                        <span class=\"event_dates\">\n                            <span>${dateFromACFField(date)}${time ? `,` : \"\"}</span>\n                            ${time ? `<span>${time}</span>` : \"\"}\n                            ${end_date ? `<span>-&nbsp;</span><span>${dateFromACFField(end_date)}${end_time ? `,` : \"\"}</span>` : \"\"}\n                            ${end_time ? `<span>${end_time}</span>` : \"\"}\n                        </span>\n                        <span class='divider'>•</span>\n                        <span class=\"event_type\">${event_type[0].name}</span>\n                        <span class='divider'>•</span>\n                        <span class=\"event_location\">${location}</span>\n                    </div>\n                    <div class=\"event_name\">\n                        <h2>\n                            <span class=\"event_title\">${post_title}</span>\n                            ${artists ? `<span class=\"event_artists\">by ${artists}</span>` : \"\"}\n                        </h2>\n                    </div>\n                    <p class=\"event_description\">${excerpt}</p>\n                </div>\n            </div>\n        `;\n    }\n    catch (e) {\n        console.error(e.message, event);\n        return \"\";\n    }\n}\n\nlet page = 0;\nlet events = [];\n\nasync function getEvents() {\n    page = 0;\n    let dateparam = new URL(window.location.href).searchParams.get(\"date\");\n    const queryURL = `/wp-json/wp/v2/events${dateparam ? `?date=${dateparam}` : \"\"}`;\n\n    events = await (await fetch(queryURL)).json();\n    block_div.innerHTML = events.map(e => eventCard(e)).join(\"\");\n\n    if (events.length < 10) {\n        getNextPage();\n    }\n}\n\nasync function getNextPage() {\n    page++;\n\n    let dateparam = new URL(window.location.href).searchParams.get(\"date\");\n    if (!dateparam) {\n        dateparam = new Date().getFullYear() + '' + (new Date().getMonth() + 1) + '' + new Date().getDate();\n    }\n\n    let newMonth = parseInt(dateparam.substring(4, 6)) + page;\n    const newYear = parseInt(dateparam.substring(0, 4)) + Math.floor(newMonth / 12);\n    newMonth = newMonth % 12;\n    dateparam = newYear + '' + newMonth + '01';\n\n    console.log(dateparam);\n\n    const queryURL = `/wp-json/wp/v2/events?date=${dateparam}`;\n\n    newEvents = await (await fetch(queryURL)).json();\n\n    newEvents = newEvents.filter(function (item, pos, self) {\n        return !events.includes();\n    });\n\n    events = [...events, ...newEvents];\n\n\n    block_div.innerHTML += newEvents.map(e => eventCard(e)).join(\"\");\n}\n\nlet fetching = false\n\nasync function checkScroll() {\n    if (!fetching && window.innerHeight + window.scrollY >= block_div.clientHeight * 0.8) {\n        fetching = true;\n        await getNextPage();\n        fetching = false;\n    }\n}\n\n\ndocument.addEventListener(\"DOMContentLoaded\", getEvents);\nwindow.addEventListener(\"popstate\", getEvents);\nwindow.addEventListener(\"scroll\", checkScroll);\n\n/* eslint-enable no-console */\n"],"names":["block_div","document","querySelector","dateFromACFField","date","year","substring","month","day","Date","toLocaleString","eventCard","event","post_title","acf","featured_image","guid","status","excerpt","time","end_date","end_time","location","event_type","artists","name","e","console","error","message","page","events","getEvents","dateparam","URL","window","href","searchParams","get","queryURL","fetch","json","innerHTML","map","join","length","getNextPage","getFullYear","getMonth","getDate","newMonth","parseInt","newYear","Math","floor","log","newEvents","filter","item","pos","self","includes","fetching","checkScroll","innerHeight","scrollY","clientHeight","addEventListener"],"sourceRoot":""}