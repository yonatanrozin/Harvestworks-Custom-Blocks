{"version":3,"file":"event-calendar/view.js","mappings":"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","sources":["webpack://harvestworks/./src/event-calendar/view.js"],"sourcesContent":["/* eslint-disable no-console */\r\n\r\nconst offsets = new Array(6).fill(undefined).map(() => {\r\n    const cell = document.createElement(\"div\");\r\n    cell.classList.add(\"calendar_offset\");\r\n    cell.style.height = \"100%\";\r\n    return cell;\r\n})\r\nconst cells = document.querySelectorAll(\".calendar_day\");\r\nconst url = new URL(window.location.href);\r\n\r\n// month & year being viewed on the calendar:\r\n// get from url search params or default to current date\r\nlet dateView = dateFromACFField(url.searchParams.get(\"date\"));\r\n\r\nif (!dateView) {\r\n    url.searchParams.delete(\"date\");\r\n    history.pushState({}, \"\", url);\r\n    window.dispatchEvent(new PopStateEvent(\"popstate\"));\r\n    dateView = new Date();\r\n}\r\n\r\nconst month = dateView.getMonth();\r\nconst year = dateView.getFullYear();\r\nconst firstOfMonth = new Date(year, month, 1).getDay();\r\n\r\ndocument.querySelector(\".calendar_day\").style.gridColumnStart = firstOfMonth + 1;\r\ndocument.querySelector(\"#calendar_date h3\").innerHTML =\r\ndateView.toLocaleString(\"default\", { month: \"short\" }) + \" \" +\r\ndateView.toLocaleString(\"default\", { year: \"numeric\" });\r\n\r\nfunction dateFromACFField(date) {\r\n    const len = date?.length;\r\n    if (len !== 8) return null;\r\n    const year = date.substring(0, 4);\r\n    const month = date.substring(4, 6) - 1; //JS months counting from 0\r\n    const day = date.substring(6, 8);\r\n    const jsdate = new Date(year, month, day);\r\n    if (jsdate == \"Invalid Date\") return null;\r\n    return jsdate;\r\n}\r\n\r\nfunction calendarSetup(events = window.hw_events) {\r\n\r\n    window.hw_events = events;\r\n\r\n    const dateSearch = url.searchParams.get(\"date\") ||\r\n        new Date().toISOString().split('T')[0].split(\"-\").join(\"\");\r\n\r\n    const month = dateView.getMonth();\r\n    const year = dateView.getFullYear();\r\n\r\n    const daysInMonth = new Date(year, month + 1, 0).getDate();\r\n    for (const cell of cells) {\r\n        if (Number(cell.id) > daysInMonth) {\r\n            cell.style.display = \"none\";\r\n            continue;\r\n        }\r\n        cell.style.display = \"flex\";\r\n\r\n        //cell represented date = viewed year/month on calendar + cell id as day\r\n        const cellDate = new Date(year, month, cell.id).toISOString().split(\"T\")[0].split(\"-\").join(\"\");\r\n\r\n        const isQueried = dateSearch === cellDate;\r\n\r\n        if (isQueried) {\r\n            cell.classList.add(\"queried\");\r\n        } else cell.classList.remove(\"queried\");\r\n\r\n        function setURLDateQuery() {\r\n            const newParam = cellDate;\r\n            const oldParam = url.searchParams.get(\"date\");\r\n            if (newParam == oldParam) {\r\n                url.searchParams.delete(\"date\");\r\n                window.sessionStorage.removeItem(\"hw_calendar_date\");\r\n            }\r\n            else {\r\n                window.sessionStorage.setItem(\"hw_calendar_date\", newParam);\r\n                url.searchParams.set(\"date\", newParam);\r\n            }\r\n            history.pushState({}, \"\", url);\r\n            window.dispatchEvent(new PopStateEvent(\"popstate\"));\r\n        }\r\n\r\n        for (const i in events) {\r\n            const event = events[i];\r\n\r\n            try {\r\n                const {date, end_date} = event.acf;\r\n                \r\n                const start = date.value;\r\n                const end = end_date?.value;\r\n                \r\n                const hasEvent = cellDate >= start && cellDate <= (end ?? start);\r\n                cell.onclick = setURLDateQuery;\r\n                if (hasEvent) {\r\n                    cell.classList.add(\"has_event\");\r\n                    break;\r\n                } else cell.classList.remove(\"has_event\");\r\n            } \r\n            catch (e) {\r\n                console.error(e.message, event.title.rendered, event);\r\n                continue;\r\n            }\r\n        }\r\n    }\r\n\r\n    const firstOfMonth = new Date(year, month, 1).getDay();\r\n\r\n    document.querySelector(\".calendar_day\").style.gridColumnStart = firstOfMonth + 1;\r\n    document.querySelector(\"#calendar_date h3\").innerHTML =\r\n        dateView.toLocaleString(\"default\", { month: \"short\" }) + \" \" +\r\n        dateView.toLocaleString(\"default\", { year: \"numeric\" });\r\n}\r\n\r\nfunction nextMonth() {\r\n    dateView.setMonth(dateView.getMonth() + 1);\r\n    calendarSetup();\r\n}\r\nfunction prevMonth() {\r\n    dateView.setMonth(dateView.getMonth() - 1);\r\n    calendarSetup();\r\n}\r\n\r\ndocument.getElementById(\"nextMonthButton\").addEventListener(\"click\", nextMonth)\r\ndocument.getElementById(\"prevMonthButton\").addEventListener(\"click\", prevMonth)\r\n\r\nwindow.addEventListener(\"popstate\", () => calendarSetup());\r\nfetch(\"/wp-json/wp/v2/event\").then(res => res.json()).then(calendarSetup);\r\n\r\n/* eslint-enable no-console */\r\n"],"names":["offsets","Array","fill","undefined","map","cell","document","createElement","classList","add","style","height","cells","querySelectorAll","url","URL","window","location","href","dateView","dateFromACFField","searchParams","get","delete","history","pushState","dispatchEvent","PopStateEvent","Date","month","getMonth","year","getFullYear","firstOfMonth","getDay","querySelector","gridColumnStart","innerHTML","toLocaleString","date","len","length","substring","day","jsdate","calendarSetup","events","hw_events","dateSearch","toISOString","split","join","daysInMonth","getDate","Number","id","display","cellDate","isQueried","remove","setURLDateQuery","newParam","oldParam","sessionStorage","removeItem","setItem","set","i","event","end_date","acf","start","value","end","hasEvent","onclick","e","console","error","message","title","rendered","nextMonth","setMonth","prevMonth","getElementById","addEventListener","fetch","then","res","json"],"sourceRoot":""}