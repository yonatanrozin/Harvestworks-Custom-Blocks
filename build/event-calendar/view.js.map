{"version":3,"file":"event-calendar/view.js","mappings":"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","sources":["webpack://harvestworks/./src/event-calendar/view.js"],"sourcesContent":["/* eslint-disable no-console */\r\n\r\nconst offsets = new Array(6).fill(undefined).map(() => {\r\n    const cell = document.createElement(\"div\");\r\n    cell.classList.add(\"calendar_offset\");\r\n    cell.style.height = \"100%\";\r\n    return cell;\r\n})\r\nconst cells = document.querySelectorAll(\".calendar_day\");\r\nconst url = new URL(window.location.href);\r\n\r\n// month & year being viewed on the calendar:\r\n// get from url search params or default to current date\r\nlet dateView = dateFromACFField(url.searchParams.get(\"date\"));\r\n\r\nconst month = dateView.getMonth();\r\nconst year = dateView.getFullYear();\r\nconst firstOfMonth = new Date(year, month, 1).getDay();\r\n\r\ndocument.querySelector(\".calendar_day\").style.gridColumnStart = firstOfMonth + 1;\r\ndocument.querySelector(\"#calendar_date h3\").innerHTML =\r\n    dateView.toLocaleString(\"default\", { month: \"short\" }) + \" \" +\r\n    dateView.toLocaleString(\"default\", { year: \"numeric\" });\r\n\r\nif (!dateView) {\r\n    url.searchParams.delete(\"date\");\r\n    history.pushState({}, \"\", url);\r\n    window.dispatchEvent(new PopStateEvent(\"popstate\"));\r\n    dateView = new Date();\r\n}\r\n\r\nfunction dateFromACFField(date) {\r\n    const len = date?.length;\r\n    if (len !== 8) return null;\r\n    const year = date.substring(0, 4);\r\n    const month = date.substring(4, 6) - 1; //JS months counting from 0\r\n    const day = date.substring(6, 8);\r\n    const jsdate = new Date(year, month, day);\r\n    if (jsdate == \"Invalid Date\") return null;\r\n    return jsdate;\r\n}\r\n\r\nlet latestEvents;\r\n\r\nfunction calendarSetup(events = latestEvents) {\r\n\r\n    latestEvents = events;\r\n\r\n    const dateSearch = url.searchParams.get(\"date\") ||\r\n        new Date().toISOString().split('T')[0].split(\"-\").join(\"\");\r\n\r\n    const month = dateView.getMonth();\r\n    const year = dateView.getFullYear();\r\n\r\n    const daysInMonth = new Date(year, month + 1, 0).getDate();\r\n    for (const cell of cells) {\r\n        if (Number(cell.id) > daysInMonth) {\r\n            cell.style.display = \"none\";\r\n            continue;\r\n        }\r\n        cell.style.display = \"flex\";\r\n\r\n        //cell represented date = viewed year/month on calendar + cell id as day\r\n        const cellDate = new Date(year, month, cell.id).toISOString().split(\"T\")[0].split(\"-\").join(\"\");\r\n\r\n        const isQueried = dateSearch === cellDate;\r\n\r\n        if (isQueried) {\r\n            cell.classList.add(\"queried\");\r\n        } else cell.classList.remove(\"queried\");\r\n\r\n        function setURLDateQuery() {\r\n            const newParam = cellDate;\r\n            const oldParam = url.searchParams.get(\"date\");\r\n            if (newParam == oldParam) {\r\n                url.searchParams.delete(\"date\");\r\n                window.sessionStorage.removeItem(\"hw_calendar_date\");\r\n            }\r\n            else {\r\n                window.sessionStorage.setItem(\"hw_calendar_date\", newParam);\r\n                url.searchParams.set(\"date\", newParam);\r\n            }\r\n            history.pushState({}, \"\", url);\r\n            window.dispatchEvent(new PopStateEvent(\"popstate\"));\r\n        }\r\n\r\n        for (const i in events) {\r\n            const {date, end_date} = events[i].acf;\r\n\r\n            const start = date.value;\r\n            const end = end_date?.value;\r\n\r\n            const hasEvent = cellDate >= start && cellDate <= (end ?? start);\r\n            cell.onclick = setURLDateQuery;\r\n            if (hasEvent) {\r\n                cell.classList.add(\"has_event\");\r\n                break;\r\n            } else cell.classList.remove(\"has_event\");\r\n        }\r\n    }\r\n\r\n    const firstOfMonth = new Date(year, month, 1).getDay();\r\n\r\n    document.querySelector(\".calendar_day\").style.gridColumnStart = firstOfMonth + 1;\r\n    document.querySelector(\"#calendar_date h3\").innerHTML =\r\n        dateView.toLocaleString(\"default\", { month: \"short\" }) + \" \" +\r\n        dateView.toLocaleString(\"default\", { year: \"numeric\" });\r\n}\r\n\r\nfunction nextMonth() {\r\n    dateView.setMonth(dateView.getMonth() + 1);\r\n    calendarSetup();\r\n}\r\nfunction prevMonth() {\r\n    dateView.setMonth(dateView.getMonth() - 1);\r\n    calendarSetup();\r\n}\r\n\r\ndocument.getElementById(\"nextMonthButton\").addEventListener(\"click\", nextMonth)\r\ndocument.getElementById(\"prevMonthButton\").addEventListener(\"click\", prevMonth)\r\n\r\nwindow.addEventListener(\"popstate\", () => calendarSetup());\r\nfetch(\"/wp-json/wp/v2/event\").then(res => res.json()).then(calendarSetup);\r\n\r\n/* eslint-enable no-console */\r\n"],"names":["offsets","Array","fill","undefined","map","cell","document","createElement","classList","add","style","height","cells","querySelectorAll","url","URL","window","location","href","dateView","dateFromACFField","searchParams","get","month","getMonth","year","getFullYear","firstOfMonth","Date","getDay","querySelector","gridColumnStart","innerHTML","toLocaleString","delete","history","pushState","dispatchEvent","PopStateEvent","date","len","length","substring","day","jsdate","latestEvents","calendarSetup","events","dateSearch","toISOString","split","join","daysInMonth","getDate","Number","id","display","cellDate","isQueried","remove","setURLDateQuery","newParam","oldParam","sessionStorage","removeItem","setItem","set","i","end_date","acf","start","value","end","hasEvent","onclick","nextMonth","setMonth","prevMonth","getElementById","addEventListener","fetch","then","res","json"],"sourceRoot":""}