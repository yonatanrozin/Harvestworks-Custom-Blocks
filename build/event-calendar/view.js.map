{"version":3,"file":"event-calendar/view.js","mappings":";;;;AAAA;;AAEA,MAAMA,OAAO,GAAG,IAAIC,KAAK,CAAC,CAAC,CAAC,CAACC,IAAI,CAACC,SAAS,CAAC,CAACC,GAAG,CAAC,MAAM;EACnD,MAAMC,IAAI,GAAGC,QAAQ,CAACC,aAAa,CAAC,KAAK,CAAC;EAC1CF,IAAI,CAACG,SAAS,CAACC,GAAG,CAAC,iBAAiB,CAAC;EACrCJ,IAAI,CAACK,KAAK,CAACC,MAAM,GAAG,MAAM;EAC1B,OAAON,IAAI;AACf,CAAC,CAAC;AACF,MAAMO,KAAK,GAAGN,QAAQ,CAACO,gBAAgB,CAAC,eAAe,CAAC;AACxD,MAAMC,GAAG,GAAG,IAAIC,GAAG,CAACC,MAAM,CAACC,QAAQ,CAACC,IAAI,CAAC;;AAEzC;AACA;AACA,IAAIC,QAAQ,GAAGC,gBAAgB,CAACN,GAAG,CAACO,YAAY,CAACC,GAAG,CAAC,MAAM,CAAC,CAAC;AAE7D,IAAI,CAACH,QAAQ,EAAE;EACXL,GAAG,CAACO,YAAY,CAACE,MAAM,CAAC,MAAM,CAAC;EAC/BC,OAAO,CAACC,SAAS,CAAC,CAAC,CAAC,EAAE,EAAE,EAAEX,GAAG,CAAC;EAC9BE,MAAM,CAACU,aAAa,CAAC,IAAIC,aAAa,CAAC,UAAU,CAAC,CAAC;EACnDR,QAAQ,GAAG,IAAIS,IAAI,CAAC,CAAC;AACzB;AAEA,MAAMC,KAAK,GAAGV,QAAQ,CAACW,QAAQ,CAAC,CAAC;AACjC,MAAMC,IAAI,GAAGZ,QAAQ,CAACa,WAAW,CAAC,CAAC;AACnC,MAAMC,YAAY,GAAG,IAAIL,IAAI,CAACG,IAAI,EAAEF,KAAK,EAAE,CAAC,CAAC,CAACK,MAAM,CAAC,CAAC;AAEtD5B,QAAQ,CAAC6B,aAAa,CAAC,eAAe,CAAC,CAACzB,KAAK,CAAC0B,eAAe,GAAGH,YAAY,GAAG,CAAC;AAChF3B,QAAQ,CAAC6B,aAAa,CAAC,mBAAmB,CAAC,CAACE,SAAS,GACjDlB,QAAQ,CAACmB,cAAc,CAAC,SAAS,EAAE;EAAET,KAAK,EAAE;AAAQ,CAAC,CAAC,GAAG,GAAG,GAC5DV,QAAQ,CAACmB,cAAc,CAAC,SAAS,EAAE;EAAEP,IAAI,EAAE;AAAU,CAAC,CAAC;AAE3D,SAASX,gBAAgBA,CAACmB,IAAI,EAAE;EAC5B,MAAMC,GAAG,GAAGD,IAAI,EAAEE,MAAM;EACxB,IAAID,GAAG,KAAK,CAAC,EAAE,OAAO,IAAI;EAC1B,MAAMT,IAAI,GAAGQ,IAAI,CAACG,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC;EACjC,MAAMb,KAAK,GAAGU,IAAI,CAACG,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;EACxC,MAAMC,GAAG,GAAGJ,IAAI,CAACG,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC;EAChC,MAAME,MAAM,GAAG,IAAIhB,IAAI,CAACG,IAAI,EAAEF,KAAK,EAAEc,GAAG,CAAC;EACzC,IAAIC,MAAM,IAAI,cAAc,EAAE,OAAO,IAAI;EACzC,OAAOA,MAAM;AACjB;AAEA,eAAeC,aAAaA,CAAA,EAAG;EAE3B,MAAMC,QAAQ,GAAGhC,GAAG,CAACO,YAAY,CAACC,GAAG,CAAC,MAAM,CAAC;EAC7CyB,KAAK,CAAC,6BAA6B,GAAGD,QAAQ,CAAC,CAACE,IAAI,CAACC,GAAG,IAAIA,GAAG,CAACC,IAAI,CAAC,CAAC,CAAC,CAACF,IAAI,CAACG,MAAM,IAAI;IACnF,KAAK,MAAM9C,IAAI,IAAIO,KAAK,EAAE;MACtB,KAAK,MAAMwC,CAAC,IAAID,MAAM,EAAE;QACpB,MAAME,KAAK,GAAGF,MAAM,CAACC,CAAC,CAAC;QAEvB,IAAI;UACA,MAAM;YAAEb,IAAI;YAAEe;UAAS,CAAC,GAAGD,KAAK,CAACE,GAAG;UAEpC,MAAMC,KAAK,GAAGjB,IAAI,CAACkB,KAAK;UACxB,MAAMC,GAAG,GAAGJ,QAAQ,EAAEG,KAAK;UAE3B,MAAME,QAAQ,GAAGC,QAAQ,IAAIJ,KAAK,IAAII,QAAQ,KAAKF,GAAG,aAAHA,GAAG,cAAHA,GAAG,GAAIF,KAAK,CAAC;UAChE,IAAIG,QAAQ,EAAE;YACVtD,IAAI,CAACG,SAAS,CAACC,GAAG,CAAC,WAAW,CAAC;YAC/B;UACJ,CAAC,MAAMJ,IAAI,CAACG,SAAS,CAACqD,MAAM,CAAC,WAAW,CAAC;QAC7C,CAAC,CACD,OAAOC,CAAC,EAAE;UACNC,OAAO,CAACC,KAAK,CAACF,CAAC,CAACG,OAAO,EAAEZ,KAAK,CAACa,KAAK,CAACC,QAAQ,EAAEd,KAAK,CAAC;UACrD;QACJ;MACJ;IACJ;EACJ,CAAC,CAAC;EAGF,MAAMe,UAAU,GAAGtD,GAAG,CAACO,YAAY,CAACC,GAAG,CAAC,MAAM,CAAC,IAC3C,IAAIM,IAAI,CAAC,CAAC,CAACyC,WAAW,CAAC,CAAC,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAACA,KAAK,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC,EAAE,CAAC;EAE9D,MAAM1C,KAAK,GAAGV,QAAQ,CAACW,QAAQ,CAAC,CAAC;EACjC,MAAMC,IAAI,GAAGZ,QAAQ,CAACa,WAAW,CAAC,CAAC;EAEnC,MAAMwC,WAAW,GAAG,IAAI5C,IAAI,CAACG,IAAI,EAAEF,KAAK,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC4C,OAAO,CAAC,CAAC;EAC1D,KAAK,MAAMpE,IAAI,IAAIO,KAAK,EAAE;IACtB,IAAI8D,MAAM,CAACrE,IAAI,CAACsE,EAAE,CAAC,GAAGH,WAAW,EAAE;MAC/BnE,IAAI,CAACK,KAAK,CAACkE,OAAO,GAAG,MAAM;MAC3B;IACJ;IACAvE,IAAI,CAACK,KAAK,CAACkE,OAAO,GAAG,MAAM;;IAE3B;IACA,MAAMhB,QAAQ,GAAG,IAAIhC,IAAI,CAACG,IAAI,EAAEF,KAAK,EAAExB,IAAI,CAACsE,EAAE,CAAC,CAACN,WAAW,CAAC,CAAC,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAACA,KAAK,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC,EAAE,CAAC;IAE/F,MAAMM,SAAS,GAAGT,UAAU,KAAKR,QAAQ;IAEzC,IAAIiB,SAAS,EAAE;MACXxE,IAAI,CAACG,SAAS,CAACC,GAAG,CAAC,SAAS,CAAC;IACjC,CAAC,MAAMJ,IAAI,CAACG,SAAS,CAACqD,MAAM,CAAC,SAAS,CAAC;IAEvC,SAASiB,eAAeA,CAAA,EAAG;MACvB,MAAMC,QAAQ,GAAGnB,QAAQ;MACzB,MAAMoB,QAAQ,GAAGlE,GAAG,CAACO,YAAY,CAACC,GAAG,CAAC,MAAM,CAAC;MAC7C,IAAIyD,QAAQ,IAAIC,QAAQ,EAAE;QACtBlE,GAAG,CAACO,YAAY,CAACE,MAAM,CAAC,MAAM,CAAC;QAC/BP,MAAM,CAACiE,cAAc,CAACC,UAAU,CAAC,kBAAkB,CAAC;MACxD,CAAC,MACI;QACDlE,MAAM,CAACiE,cAAc,CAACE,OAAO,CAAC,kBAAkB,EAAEJ,QAAQ,CAAC;QAC3DjE,GAAG,CAACO,YAAY,CAAC+D,GAAG,CAAC,MAAM,EAAEL,QAAQ,CAAC;MAC1C;MACAvD,OAAO,CAACC,SAAS,CAAC,CAAC,CAAC,EAAE,EAAE,EAAEX,GAAG,CAAC;MAC9BE,MAAM,CAACU,aAAa,CAAC,IAAIC,aAAa,CAAC,UAAU,CAAC,CAAC;IACvD;IACAtB,IAAI,CAACgF,OAAO,GAAGP,eAAe;EAElC;EAGA,MAAM7C,YAAY,GAAG,IAAIL,IAAI,CAACG,IAAI,EAAEF,KAAK,EAAE,CAAC,CAAC,CAACK,MAAM,CAAC,CAAC;EAEtD5B,QAAQ,CAAC6B,aAAa,CAAC,eAAe,CAAC,CAACzB,KAAK,CAAC0B,eAAe,GAAGH,YAAY,GAAG,CAAC;EAChF3B,QAAQ,CAAC6B,aAAa,CAAC,mBAAmB,CAAC,CAACE,SAAS,GACjDlB,QAAQ,CAACmB,cAAc,CAAC,SAAS,EAAE;IAAET,KAAK,EAAE;EAAQ,CAAC,CAAC,GAAG,GAAG,GAC5DV,QAAQ,CAACmB,cAAc,CAAC,SAAS,EAAE;IAAEP,IAAI,EAAE;EAAU,CAAC,CAAC;AAC/D;AAEA,SAASuD,SAASA,CAAA,EAAG;EACjBnE,QAAQ,CAACoE,QAAQ,CAACpE,QAAQ,CAACW,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC;EAC1Ce,aAAa,CAAC,CAAC;AACnB;AACA,SAAS2C,SAASA,CAAA,EAAG;EACjBrE,QAAQ,CAACoE,QAAQ,CAACpE,QAAQ,CAACW,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC;EAC1Ce,aAAa,CAAC,CAAC;AACnB;AAEAvC,QAAQ,CAACmF,cAAc,CAAC,iBAAiB,CAAC,CAACC,gBAAgB,CAAC,OAAO,EAAEJ,SAAS,CAAC;AAC/EhF,QAAQ,CAACmF,cAAc,CAAC,iBAAiB,CAAC,CAACC,gBAAgB,CAAC,OAAO,EAAEF,SAAS,CAAC;AAE/ExE,MAAM,CAAC0E,gBAAgB,CAAC,UAAU,EAAE,MAAM7C,aAAa,CAAC,CAAC,CAAC;AAC1DE,KAAK,CAAC,sBAAsB,CAAC,CAACC,IAAI,CAACC,GAAG,IAAIA,GAAG,CAACC,IAAI,CAAC,CAAC,CAAC,CAACF,IAAI,CAACH,aAAa,CAAC;;AAEzE,8B","sources":["webpack://harvestworks/./src/event-calendar/view.js"],"sourcesContent":["/* eslint-disable no-console */\n\nconst offsets = new Array(6).fill(undefined).map(() => {\n    const cell = document.createElement(\"div\");\n    cell.classList.add(\"calendar_offset\");\n    cell.style.height = \"100%\";\n    return cell;\n})\nconst cells = document.querySelectorAll(\".calendar_day\");\nconst url = new URL(window.location.href);\n\n// month & year being viewed on the calendar:\n// get from url search params or default to current date\nlet dateView = dateFromACFField(url.searchParams.get(\"date\"));\n\nif (!dateView) {\n    url.searchParams.delete(\"date\");\n    history.pushState({}, \"\", url);\n    window.dispatchEvent(new PopStateEvent(\"popstate\"));\n    dateView = new Date();\n}\n\nconst month = dateView.getMonth();\nconst year = dateView.getFullYear();\nconst firstOfMonth = new Date(year, month, 1).getDay();\n\ndocument.querySelector(\".calendar_day\").style.gridColumnStart = firstOfMonth + 1;\ndocument.querySelector(\"#calendar_date h3\").innerHTML =\n    dateView.toLocaleString(\"default\", { month: \"short\" }) + \" \" +\n    dateView.toLocaleString(\"default\", { year: \"numeric\" });\n\nfunction dateFromACFField(date) {\n    const len = date?.length;\n    if (len !== 8) return null;\n    const year = date.substring(0, 4);\n    const month = date.substring(4, 6) - 1; //JS months counting from 0\n    const day = date.substring(6, 8);\n    const jsdate = new Date(year, month, day);\n    if (jsdate == \"Invalid Date\") return null;\n    return jsdate;\n}\n\nasync function calendarSetup() {\n\n    const dayParam = url.searchParams.get(\"date\");\n    fetch(\"/wp-json/wp/v2/month/?date=\" + dayParam).then(res => res.json()).then(events => {\n        for (const cell of cells) {\n            for (const i in events) {\n                const event = events[i];\n\n                try {\n                    const { date, end_date } = event.acf;\n\n                    const start = date.value;\n                    const end = end_date?.value;\n\n                    const hasEvent = cellDate >= start && cellDate <= (end ?? start);\n                    if (hasEvent) {\n                        cell.classList.add(\"has_event\");\n                        break;\n                    } else cell.classList.remove(\"has_event\");\n                }\n                catch (e) {\n                    console.error(e.message, event.title.rendered, event);\n                    continue;\n                }\n            }\n        }\n    });\n\n\n    const dateSearch = url.searchParams.get(\"date\") ||\n        new Date().toISOString().split('T')[0].split(\"-\").join(\"\");\n\n    const month = dateView.getMonth();\n    const year = dateView.getFullYear();\n\n    const daysInMonth = new Date(year, month + 1, 0).getDate();\n    for (const cell of cells) {\n        if (Number(cell.id) > daysInMonth) {\n            cell.style.display = \"none\";\n            continue;\n        }\n        cell.style.display = \"flex\";\n\n        //cell represented date = viewed year/month on calendar + cell id as day\n        const cellDate = new Date(year, month, cell.id).toISOString().split(\"T\")[0].split(\"-\").join(\"\");\n\n        const isQueried = dateSearch === cellDate;\n\n        if (isQueried) {\n            cell.classList.add(\"queried\");\n        } else cell.classList.remove(\"queried\");\n\n        function setURLDateQuery() {\n            const newParam = cellDate;\n            const oldParam = url.searchParams.get(\"date\");\n            if (newParam == oldParam) {\n                url.searchParams.delete(\"date\");\n                window.sessionStorage.removeItem(\"hw_calendar_date\");\n            }\n            else {\n                window.sessionStorage.setItem(\"hw_calendar_date\", newParam);\n                url.searchParams.set(\"date\", newParam);\n            }\n            history.pushState({}, \"\", url);\n            window.dispatchEvent(new PopStateEvent(\"popstate\"));\n        }\n        cell.onclick = setURLDateQuery;\n\n    }\n\n\n    const firstOfMonth = new Date(year, month, 1).getDay();\n\n    document.querySelector(\".calendar_day\").style.gridColumnStart = firstOfMonth + 1;\n    document.querySelector(\"#calendar_date h3\").innerHTML =\n        dateView.toLocaleString(\"default\", { month: \"short\" }) + \" \" +\n        dateView.toLocaleString(\"default\", { year: \"numeric\" });\n}\n\nfunction nextMonth() {\n    dateView.setMonth(dateView.getMonth() + 1);\n    calendarSetup();\n}\nfunction prevMonth() {\n    dateView.setMonth(dateView.getMonth() - 1);\n    calendarSetup();\n}\n\ndocument.getElementById(\"nextMonthButton\").addEventListener(\"click\", nextMonth)\ndocument.getElementById(\"prevMonthButton\").addEventListener(\"click\", prevMonth)\n\nwindow.addEventListener(\"popstate\", () => calendarSetup());\nfetch(\"/wp-json/wp/v2/month\").then(res => res.json()).then(calendarSetup);\n\n/* eslint-enable no-console */\n"],"names":["offsets","Array","fill","undefined","map","cell","document","createElement","classList","add","style","height","cells","querySelectorAll","url","URL","window","location","href","dateView","dateFromACFField","searchParams","get","delete","history","pushState","dispatchEvent","PopStateEvent","Date","month","getMonth","year","getFullYear","firstOfMonth","getDay","querySelector","gridColumnStart","innerHTML","toLocaleString","date","len","length","substring","day","jsdate","calendarSetup","dayParam","fetch","then","res","json","events","i","event","end_date","acf","start","value","end","hasEvent","cellDate","remove","e","console","error","message","title","rendered","dateSearch","toISOString","split","join","daysInMonth","getDate","Number","id","display","isQueried","setURLDateQuery","newParam","oldParam","sessionStorage","removeItem","setItem","set","onclick","nextMonth","setMonth","prevMonth","getElementById","addEventListener"],"sourceRoot":""}