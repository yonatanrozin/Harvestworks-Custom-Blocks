{"version":3,"file":"event-calendar/view.js","mappings":"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","sources":["webpack://harvestworks/./src/event-calendar/view.js"],"sourcesContent":["/* eslint-disable no-console */\n\nconst offsets = new Array(6).fill(undefined).map(() => {\n    const cell = document.createElement(\"div\");\n    cell.classList.add(\"calendar_offset\");\n    cell.style.height = \"100%\";\n    return cell;\n})\nconst cells = document.querySelectorAll(\".calendar_day\");\nconst url = new URL(window.location.href);\n\n// month & year being viewed on the calendar:\n// get from url search params or default to current date\nlet dateView = dateFromACFField(url.searchParams.get(\"date\"));\n\nif (!dateView) {\n    url.searchParams.delete(\"date\");\n    history.pushState({}, \"\", url);\n    window.dispatchEvent(new PopStateEvent(\"popstate\"));\n    dateView = new Date();\n}\n\nconst month = dateView.getMonth();\nconst year = dateView.getFullYear();\nconst firstOfMonth = new Date(year, month, 1).getDay();\n\ndocument.querySelector(\".calendar_day\").style.gridColumnStart = firstOfMonth + 1;\ndocument.querySelector(\"#calendar_date h3\").innerHTML =\ndateView.toLocaleString(\"default\", { month: \"short\" }) + \" \" +\ndateView.toLocaleString(\"default\", { year: \"numeric\" });\n\nfunction dateFromACFField(date) {\n    const len = date?.length;\n    if (len !== 8) return null;\n    const year = date.substring(0, 4);\n    const month = date.substring(4, 6) - 1; //JS months counting from 0\n    const day = date.substring(6, 8);\n    const jsdate = new Date(year, month, day);\n    if (jsdate == \"Invalid Date\") return null;\n    return jsdate;\n}\n\nfunction calendarSetup(events = window.hw_events) {\n\n    window.hw_events = events;\n\n    const dateSearch = url.searchParams.get(\"date\") ||\n        new Date().toISOString().split('T')[0].split(\"-\").join(\"\");\n\n    const month = dateView.getMonth();\n    const year = dateView.getFullYear();\n\n    const daysInMonth = new Date(year, month + 1, 0).getDate();\n    for (const cell of cells) {\n        if (Number(cell.id) > daysInMonth) {\n            cell.style.display = \"none\";\n            continue;\n        }\n        cell.style.display = \"flex\";\n\n        //cell represented date = viewed year/month on calendar + cell id as day\n        const cellDate = new Date(year, month, cell.id).toISOString().split(\"T\")[0].split(\"-\").join(\"\");\n\n        const isQueried = dateSearch === cellDate;\n\n        if (isQueried) {\n            cell.classList.add(\"queried\");\n        } else cell.classList.remove(\"queried\");\n\n        function setURLDateQuery() {\n            const newParam = cellDate;\n            const oldParam = url.searchParams.get(\"date\");\n            if (newParam == oldParam) {\n                url.searchParams.delete(\"date\");\n                window.sessionStorage.removeItem(\"hw_calendar_date\");\n            }\n            else {\n                window.sessionStorage.setItem(\"hw_calendar_date\", newParam);\n                url.searchParams.set(\"date\", newParam);\n            }\n            history.pushState({}, \"\", url);\n            window.dispatchEvent(new PopStateEvent(\"popstate\"));\n        }\n\n        for (const i in events) {\n            const event = events[i];\n\n            try {\n                const {date, end_date} = event.acf;\n                \n                const start = date.value;\n                const end = end_date?.value;\n                \n                const hasEvent = cellDate >= start && cellDate <= (end ?? start);\n                cell.onclick = setURLDateQuery;\n                if (hasEvent) {\n                    cell.classList.add(\"has_event\");\n                    break;\n                } else cell.classList.remove(\"has_event\");\n            } \n            catch (e) {\n                console.error(e.message, event.title.rendered, event);\n                continue;\n            }\n        }\n    }\n\n    const firstOfMonth = new Date(year, month, 1).getDay();\n\n    document.querySelector(\".calendar_day\").style.gridColumnStart = firstOfMonth + 1;\n    document.querySelector(\"#calendar_date h3\").innerHTML =\n        dateView.toLocaleString(\"default\", { month: \"short\" }) + \" \" +\n        dateView.toLocaleString(\"default\", { year: \"numeric\" });\n}\n\nfunction nextMonth() {\n    dateView.setMonth(dateView.getMonth() + 1);\n    calendarSetup();\n}\nfunction prevMonth() {\n    dateView.setMonth(dateView.getMonth() - 1);\n    calendarSetup();\n}\n\ndocument.getElementById(\"nextMonthButton\").addEventListener(\"click\", nextMonth)\ndocument.getElementById(\"prevMonthButton\").addEventListener(\"click\", prevMonth)\n\nwindow.addEventListener(\"popstate\", () => calendarSetup());\nfetch(\"/wp-json/wp/v2/event\").then(res => res.json()).then(calendarSetup);\n\n/* eslint-enable no-console */\n"],"names":["offsets","Array","fill","undefined","map","cell","document","createElement","classList","add","style","height","cells","querySelectorAll","url","URL","window","location","href","dateView","dateFromACFField","searchParams","get","delete","history","pushState","dispatchEvent","PopStateEvent","Date","month","getMonth","year","getFullYear","firstOfMonth","getDay","querySelector","gridColumnStart","innerHTML","toLocaleString","date","len","length","substring","day","jsdate","calendarSetup","events","hw_events","dateSearch","toISOString","split","join","daysInMonth","getDate","Number","id","display","cellDate","isQueried","remove","setURLDateQuery","newParam","oldParam","sessionStorage","removeItem","setItem","set","i","event","end_date","acf","start","value","end","hasEvent","onclick","e","console","error","message","title","rendered","nextMonth","setMonth","prevMonth","getElementById","addEventListener","fetch","then","res","json"],"sourceRoot":""}